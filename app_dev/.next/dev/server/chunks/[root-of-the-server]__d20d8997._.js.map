{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/emangue/Documents/ProjetoVSCode/ProjetoFinancasV3/app_dev/src/app/api/dashboard/metrics/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport Database from 'better-sqlite3';\nimport path from 'path';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const year = searchParams.get('year') || '2025';\n    const month = searchParams.get('month') || 'all';\n\n    const dbPath = path.join(process.cwd(), 'financas_dev.db');\n    const db = new Database(dbPath);\n\n    let whereClause = '';\n    if (month !== 'all') {\n      whereClause = `WHERE MesFatura = '${year}${month.padStart(2, '0')}'`;\n    } else {\n      whereClause = `WHERE MesFatura LIKE '${year}%'`;\n    }\n\n    // Total Despesas\n    const totalDespesas = db.prepare(`\n      SELECT COALESCE(SUM(ValorPositivo), 0) as total \n      FROM journal_entries \n      ${whereClause} AND TipoTransacao IN ('Despesas', 'Cartão de Crédito') AND IgnorarDashboard = 0\n    `).get() as { total: number };\n\n    // Total Receitas\n    const totalReceitas = db.prepare(`\n      SELECT COALESCE(SUM(ValorPositivo), 0) as total \n      FROM journal_entries \n      ${whereClause} AND TipoTransacao = 'Receitas' AND IgnorarDashboard = 0\n    `).get() as { total: number };\n\n    // Saldo Atual (Receitas - Despesas)\n    const saldoAtual = totalReceitas.total - totalDespesas.total;\n\n    // Total de Transações\n    const totalTransacoes = db.prepare(`\n      SELECT COUNT(*) as total \n      FROM journal_entries\n      ${whereClause} AND IgnorarDashboard = 0\n    `).get() as { total: number };\n\n    db.close();\n\n    return NextResponse.json({\n      totalDespesas: totalDespesas.total,\n      totalReceitas: totalReceitas.total,\n      saldoAtual: saldoAtual,\n      totalTransacoes: totalTransacoes.total\n    });\n  } catch (error) {\n    console.error('Error fetching metrics:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;QAE3C,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QACxC,MAAM,KAAK,IAAI,8LAAQ,CAAC;QAExB,IAAI,cAAc;QAClB,IAAI,UAAU,OAAO;YACnB,cAAc,CAAC,mBAAmB,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG,KAAK,CAAC,CAAC;QACtE,OAAO;YACL,cAAc,CAAC,sBAAsB,EAAE,KAAK,EAAE,CAAC;QACjD;QAEA,iBAAiB;QACjB,MAAM,gBAAgB,GAAG,OAAO,CAAC,CAAC;;;MAGhC,EAAE,YAAY;IAChB,CAAC,EAAE,GAAG;QAEN,iBAAiB;QACjB,MAAM,gBAAgB,GAAG,OAAO,CAAC,CAAC;;;MAGhC,EAAE,YAAY;IAChB,CAAC,EAAE,GAAG;QAEN,oCAAoC;QACpC,MAAM,aAAa,cAAc,KAAK,GAAG,cAAc,KAAK;QAE5D,sBAAsB;QACtB,MAAM,kBAAkB,GAAG,OAAO,CAAC,CAAC;;;MAGlC,EAAE,YAAY;IAChB,CAAC,EAAE,GAAG;QAEN,GAAG,KAAK;QAER,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,eAAe,cAAc,KAAK;YAClC,eAAe,cAAc,KAAK;YAClC,YAAY;YACZ,iBAAiB,gBAAgB,KAAK;QACxC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}