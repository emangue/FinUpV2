{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/emangue/Documents/ProjetoVSCode/ProjetoFinancasV3/app_dev/src/app/api/dashboard/categories/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport Database from 'better-sqlite3';\nimport path from 'path';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const year = searchParams.get('year') || '2025';\n    const month = searchParams.get('month') || 'all';\n\n    const dbPath = path.join(process.cwd(), 'financas_dev.db');\n    const db = new Database(dbPath);\n\n    // Tipos de gasto a excluir\n    const tiposExcluir = [\n      'Investimento - Ajustável',\n      'Investimento - Fixo', \n      'Pagamento Fatura',\n      'Receita - Outras',\n      'Receita - Salário',\n      'Salário',\n      'Transferência'\n    ];\n    \n    let whereClause = `WHERE TipoTransacao IN ('Despesas', 'Cartão de Crédito')\n      AND IgnorarDashboard = 0\n      AND TipoGasto NOT IN ('${tiposExcluir.join(\"', '\")}')\n      AND TipoGasto IS NOT NULL`;\n    \n    if (month !== 'all') {\n      whereClause += ` AND MesFatura = '${year}${month.padStart(2, '0')}'`;\n    } else {\n      whereClause += ` AND MesFatura LIKE '${year}%'`;\n    }\n\n    // Buscar total de receitas para calcular percentuais\n    const totalReceitas = db.prepare(`\n      SELECT COALESCE(SUM(ValorPositivo), 1) as total \n      FROM journal_entries \n      WHERE TipoTransacao = 'Receitas'\n      AND IgnorarDashboard = 0\n      ${month !== 'all' ? `AND MesFatura = '${year}${month.padStart(2, '0')}'` : `AND MesFatura LIKE '${year}%'`}\n    `).get() as { total: number };\n\n    // Buscar gastos por TipoGasto\n    const categoryData = db.prepare(`\n      SELECT \n        TipoGasto as categoria,\n        SUM(ValorPositivo) as valor,\n        (SUM(ValorPositivo) / ${totalReceitas.total} * 100) as percentual\n      FROM journal_entries\n      ${whereClause}\n      GROUP BY TipoGasto\n      HAVING valor > 0\n      ORDER BY valor DESC\n      LIMIT 10\n    `).all() as Array<{ categoria: string; valor: number; percentual: number }>;\n\n    db.close();\n\n    return NextResponse.json(categoryData);\n  } catch (error) {\n    console.error('Error fetching category data:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;QAE3C,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QACxC,MAAM,KAAK,IAAI,8LAAQ,CAAC;QAExB,2BAA2B;QAC3B,MAAM,eAAe;YACnB;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,IAAI,cAAc,CAAC;;6BAEM,EAAE,aAAa,IAAI,CAAC,QAAQ;+BAC1B,CAAC;QAE5B,IAAI,UAAU,OAAO;YACnB,eAAe,CAAC,kBAAkB,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG,KAAK,CAAC,CAAC;QACtE,OAAO;YACL,eAAe,CAAC,qBAAqB,EAAE,KAAK,EAAE,CAAC;QACjD;QAEA,qDAAqD;QACrD,MAAM,gBAAgB,GAAG,OAAO,CAAC,CAAC;;;;;MAKhC,EAAE,UAAU,QAAQ,CAAC,iBAAiB,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG,KAAK,CAAC,CAAC,GAAG,CAAC,oBAAoB,EAAE,KAAK,EAAE,CAAC,CAAC;IAC7G,CAAC,EAAE,GAAG;QAEN,8BAA8B;QAC9B,MAAM,eAAe,GAAG,OAAO,CAAC,CAAC;;;;8BAIP,EAAE,cAAc,KAAK,CAAC;;MAE9C,EAAE,YAAY;;;;;IAKhB,CAAC,EAAE,GAAG;QAEN,GAAG,KAAK;QAER,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}