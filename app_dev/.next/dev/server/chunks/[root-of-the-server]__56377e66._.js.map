{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/emangue/Documents/ProjetoVSCode/ProjetoFinancasV3/app_dev/src/app/api/transactions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport Database from 'better-sqlite3'\nimport path from 'path'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const type = searchParams.get('type') || 'all' // all, receitas, despesas\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '10')\n    const offset = (page - 1) * limit\n\n    // Filtros avançados\n    const estabelecimento = searchParams.get('estabelecimento')\n    const grupo = searchParams.get('grupo')\n    const subgrupo = searchParams.get('subgrupo')\n    const tipoGasto = searchParams.get('tipoGasto')\n    const banco = searchParams.get('banco')\n    const mesInicio = searchParams.get('mesInicio')\n    const mesFim = searchParams.get('mesFim')\n\n    const dbPath = path.join(process.cwd(), 'financas_dev.db')\n    const db = new Database(dbPath)\n\n    const whereClauses = ['IgnorarDashboard = 0']\n    const params: any[] = []\n    \n    if (type === 'receitas') {\n      whereClauses.push(\"TipoTransacao = ?\")\n      params.push('Receitas')\n    } else if (type === 'despesas') {\n      whereClauses.push(\"(TipoTransacao = ? OR TipoTransacao = ?)\")\n      params.push('Despesas', 'Cartão de Crédito')\n    }\n\n    if (estabelecimento) {\n      whereClauses.push('Estabelecimento LIKE ?')\n      params.push(`%${estabelecimento}%`)\n    }\n\n    if (grupo && grupo.trim()) {\n      whereClauses.push('GRUPO = ?')\n      params.push(grupo.trim())\n    }\n\n    if (subgrupo) {\n      whereClauses.push('SUBGRUPO LIKE ?')\n      params.push(`%${subgrupo}%`)\n    }\n\n    if (tipoGasto && tipoGasto.trim()) {\n      whereClauses.push('TipoGasto = ?')\n      params.push(tipoGasto.trim())\n    }\n\n    if (banco && banco.trim()) {\n      whereClauses.push('banco_origem = ?')\n      params.push(banco.trim())\n    }\n\n    if (mesInicio) {\n      whereClauses.push('MesFatura >= ?')\n      params.push(mesInicio)\n    }\n\n    if (mesFim) {\n      whereClauses.push('MesFatura <= ?')\n      params.push(mesFim)\n    }\n\n    const whereClause = 'WHERE ' + whereClauses.join(' AND ')\n\n    // Buscar total de registros\n    const countQuery = `SELECT COUNT(*) as total FROM journal_entries ${whereClause}`\n    const countResult = db.prepare(countQuery).get(...params) as { total: number }\n    const total = countResult.total\n\n    // Buscar transações\n    const query = `\n      SELECT \n        IdTransacao,\n        Data,\n        Estabelecimento,\n        ValorPositivo,\n        TipoTransacao,\n        GRUPO,\n        SUBGRUPO,\n        TipoGasto,\n        origem_classificacao,\n        MesFatura,\n        banco_origem,\n        NomeCartao\n      FROM journal_entries\n      ${whereClause}\n      ORDER BY Data DESC\n      LIMIT ? OFFSET ?\n    `\n\n    const transactions = db.prepare(query).all(...params, limit, offset)\n\n    db.close()\n\n    return NextResponse.json({\n      transactions,\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit)\n      }\n    })\n  } catch (error) {\n    console.error('Erro ao buscar transações:', error)\n    return NextResponse.json({ \n      error: 'Erro interno do servidor' \n    }, { status: 500 })\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW,MAAM,0BAA0B;;QACzE,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,oBAAoB;QACpB,MAAM,kBAAkB,aAAa,GAAG,CAAC;QACzC,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QACxC,MAAM,KAAK,IAAI,8LAAQ,CAAC;QAExB,MAAM,eAAe;YAAC;SAAuB;QAC7C,MAAM,SAAgB,EAAE;QAExB,IAAI,SAAS,YAAY;YACvB,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC;QACd,OAAO,IAAI,SAAS,YAAY;YAC9B,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,YAAY;QAC1B;QAEA,IAAI,iBAAiB;YACnB,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;QACpC;QAEA,IAAI,SAAS,MAAM,IAAI,IAAI;YACzB,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,MAAM,IAAI;QACxB;QAEA,IAAI,UAAU;YACZ,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;QAC7B;QAEA,IAAI,aAAa,UAAU,IAAI,IAAI;YACjC,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,UAAU,IAAI;QAC5B;QAEA,IAAI,SAAS,MAAM,IAAI,IAAI;YACzB,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC,MAAM,IAAI;QACxB;QAEA,IAAI,WAAW;YACb,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC;QACd;QAEA,IAAI,QAAQ;YACV,aAAa,IAAI,CAAC;YAClB,OAAO,IAAI,CAAC;QACd;QAEA,MAAM,cAAc,WAAW,aAAa,IAAI,CAAC;QAEjD,4BAA4B;QAC5B,MAAM,aAAa,CAAC,8CAA8C,EAAE,aAAa;QACjF,MAAM,cAAc,GAAG,OAAO,CAAC,YAAY,GAAG,IAAI;QAClD,MAAM,QAAQ,YAAY,KAAK;QAE/B,oBAAoB;QACpB,MAAM,QAAQ,CAAC;;;;;;;;;;;;;;;MAeb,EAAE,YAAY;;;IAGhB,CAAC;QAED,MAAM,eAAe,GAAG,OAAO,CAAC,OAAO,GAAG,IAAI,QAAQ,OAAO;QAE7D,GAAG,KAAK;QAER,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,YAAY;gBACV;gBACA;gBACA;gBACA,YAAY,KAAK,IAAI,CAAC,QAAQ;YAChC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;QACT,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}